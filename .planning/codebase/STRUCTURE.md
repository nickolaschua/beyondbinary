# Codebase Structure

**Analysis Date:** 2026-02-10

## Directory Layout

```
beyondbinary/
├── .claude/                    # Claude Code settings
├── .planning/                  # Planning documents
│   └── codebase/              # Codebase analysis (this directory)
├── docs/                       # Project documentation
│   ├── PRD.md                 # Product Requirements Document
│   ├── TODO.md                # Task list for Ralph loop
│   └── streams/               # Per-stream TODO files
├── logs/                       # Ralph execution logs (generated)
├── ml/                         # Core ML pipeline
│   ├── models/                # Trained model artifacts
│   ├── MP_Data/               # Training data (generated)
│   ├── tests/                 # Automated pytest suite
│   ├── venv/                  # Python 3.12 virtual environment
│   ├── conftest.py            # Root pytest config
│   ├── utils.py               # Shared constants & utilities
│   ├── collect_data.py        # Data collection entry point
│   ├── verify_data.py         # Data verification entry point
│   ├── train_model.py         # Model training entry point
│   ├── ws_server.py           # WebSocket server entry point
│   ├── test_realtime.py       # Manual: live inference test
│   ├── test_setup.py          # Manual: environment check
│   ├── test_ws_client.py      # Manual: WebSocket stress test
│   ├── test_ws_health.py      # Manual: health endpoint test
│   └── requirements.txt       # Pinned Python dependencies
├── scripts/
│   └── ralph/                 # Autonomous AI loop
│       ├── ralph.sh           # Main loop entry point
│       ├── parallel-run.sh    # Parallel execution support
│       ├── parallel-setup.sh  # Parallel setup support
│       ├── CLAUDE.md          # Main Claude prompt template
│       └── CLAUDE-*.md        # Stream-specific prompts
├── vendor/
│   └── ralph-loop/            # Vendored reference implementation
│       ├── flowchart/         # React + Vite visualization
│       │   ├── src/           # TypeScript/React source
│       │   ├── package.json   # NPM dependencies
│       │   └── vite.config.ts # Build configuration
│       ├── skills/            # Reference skill definitions
│       └── README.md          # Ralph loop docs
├── Dockerfile                  # Container image (node:20-slim)
├── docker-compose.yml          # Service orchestration
├── Makefile                    # Build targets (ralph-once, ralph-afk)
├── README.md                   # Project overview
├── notebook1_nick.ipynb        # Jupyter: data exploration
├── notebook2_somyansh.ipynb    # Jupyter: analysis
└── .gitignore                  # Git exclusions
```

## Directory Purposes

**ml/**
- Purpose: Core ML pipeline for ASL sign detection
- Contains: Python scripts, trained models, training data, test suite
- Key files: `utils.py` (shared hub), `ws_server.py` (server), `train_model.py` (training)
- Subdirectories: `tests/` (pytest), `models/` (artifacts), `MP_Data/` (training data), `venv/` (environment)

**ml/tests/**
- Purpose: Automated pytest test suite (21 files, 114+ tests)
- Contains: `test_*.py` files, `conftest.py` with shared fixtures
- Key files: `conftest.py` (fixtures), `test_extract_keypoints.py`, `test_stability_filter.py`, `test_ws_server.py`
- Naming: `test_{module}.py` or `test_{feature}.py`

**ml/models/**
- Purpose: Saved model artifacts (generated by training)
- Contains: `action_model.h5` (Keras), `action_model_savedmodel/` (TF), `actions.npy`
- Not committed to git (generated)

**ml/MP_Data/**
- Purpose: Training data directory (generated by data collection)
- Structure: `MP_Data/{action}/{sequence_number}/{frame_number}.npy`
- 10 actions x 30 sequences x 30 frames = 9,000 `.npy` files
- Not committed to git (generated)

**scripts/ralph/**
- Purpose: Autonomous AI agent loop orchestration
- Contains: Bash scripts, Claude prompt templates
- Key files: `ralph.sh` (main loop), `CLAUDE.md` (prompt), `CLAUDE-*.md` (stream prompts)

**vendor/ralph-loop/**
- Purpose: Vendored reference implementation of Ralph loop
- Contains: React flowchart visualization, skill definitions, documentation
- Key files: `flowchart/src/App.tsx` (main component), `flowchart/package.json`
- Note: Separate from project code, reference only

**docs/**
- Purpose: Project documentation and Ralph task queue
- Contains: PRD, TODO lists
- Key files: `PRD.md` (requirements), `TODO.md` (task list with checkboxes)

## Key File Locations

**Entry Points:**
- `ml/collect_data.py` - Data collection (webcam capture)
- `ml/verify_data.py` - Data quality verification
- `ml/train_model.py` - LSTM model training
- `ml/ws_server.py` - WebSocket inference server
- `scripts/ralph/ralph.sh` - Autonomous development loop

**Configuration:**
- `ml/requirements.txt` - Python dependencies (all pinned)
- `ml/utils.py` - Shared constants and env var config
- `vendor/ralph-loop/flowchart/tsconfig.app.json` - TypeScript config
- `vendor/ralph-loop/flowchart/vite.config.ts` - Vite build config
- `vendor/ralph-loop/flowchart/eslint.config.js` - ESLint config
- `Dockerfile` - Container image definition
- `docker-compose.yml` - Service orchestration
- `Makefile` - Build targets

**Core Logic:**
- `ml/utils.py` - Shared constants, mediapipe_detection(), extract_keypoints(), StabilityFilter
- `ml/ws_server.py` - FastAPI app, WebSocket endpoint, frame decoding
- `ml/train_model.py` - LSTM architecture, training loop, evaluation
- `ml/collect_data.py` - Webcam capture, data persistence

**Testing:**
- `ml/conftest.py` - Root pytest config (patches MediaPipe globally)
- `ml/tests/conftest.py` - Shared fixtures (mock_results_all, mock_results_none, etc.)
- `ml/tests/test_*.py` - 21 automated test files

**Documentation:**
- `README.md` - Setup and usage guide
- `docs/PRD.md` - Product requirements
- `docs/TODO.md` - Task list (Ralph work queue)

## Naming Conventions

**Files:**
- `snake_case.py` for Python modules (`collect_data.py`, `ws_server.py`)
- `test_*.py` for automated tests (`test_extract_keypoints.py`)
- `UPPERCASE.md` for important documents (`README.md`, `PRD.md`, `CLAUDE.md`)
- `kebab-case` for config files (`docker-compose.yml`)
- `PascalCase.tsx` for React components (`App.tsx`)

**Directories:**
- `snake_case` for Python directories (`ml/`, `tests/`)
- `kebab-case` for multi-word directories (`ralph-loop/`)
- Plural for collections (`tests/`, `models/`, `scripts/`, `docs/`)

**Special Patterns:**
- `conftest.py` for pytest configuration (at `ml/` and `ml/tests/` levels)
- `CLAUDE*.md` for Claude prompt templates in `scripts/ralph/`
- `TODO*.md` for task lists in `docs/` and `docs/streams/`

## Where to Add New Code

**New ML Feature:**
- Primary code: `ml/` directory
- Shared utilities: Add to `ml/utils.py`
- Tests: `ml/tests/test_{feature}.py`
- Config: Environment variables in `ml/utils.py`

**New WebSocket Endpoint:**
- Implementation: `ml/ws_server.py`
- Tests: `ml/tests/test_ws_*.py`
- Shared logic: Extract to `ml/utils.py`

**New ASL Sign Action:**
- Constants: Update `ACTIONS` array in `ml/utils.py`
- Data: Collect via `ml/collect_data.py --actions NewSign`
- Retrain: Run `ml/train_model.py`

**New Ralph Task Stream:**
- Prompt: `scripts/ralph/CLAUDE-{stream}.md`
- TODO: `docs/streams/TODO-{stream}.md`
- Reference main: `docs/TODO.md`

**New Frontend Component:**
- Implementation: `vendor/ralph-loop/flowchart/src/`
- Build: `npm run build` from `vendor/ralph-loop/flowchart/`

## Special Directories

**ml/venv/**
- Purpose: Python 3.12 virtual environment
- Source: Created via `py -3.12 -m venv ml/venv`
- Committed: No (in `.gitignore`)

**ml/MP_Data/**
- Purpose: Training data (NumPy arrays)
- Source: Generated by `ml/collect_data.py`
- Committed: No (too large, generated)

**ml/models/**
- Purpose: Trained model artifacts
- Source: Generated by `ml/train_model.py`
- Committed: Partially (model files may be tracked)

**vendor/**
- Purpose: Vendored external dependencies
- Source: Copied from external ralph-loop repository
- Committed: Yes (source of truth for vendored code)

**logs/**
- Purpose: Ralph loop execution logs
- Source: Generated at runtime (`logs/ralph-YYYYMMDD.log`)
- Committed: No (in `.gitignore`)

---

*Structure analysis: 2026-02-10*
*Update when directory structure changes*
