---
phase: 11-dependency-resolution
plan: 01
type: execute
---

<objective>
Create a working Python 3.12 virtual environment with all pinned dependencies installed and verified. MediaPipe, TensorFlow, OpenCV, and all other packages import cleanly. Existing pipeline scripts run without import errors.

Purpose: The v1.0 codebase was built without a proper venv — system Python 3.13 cannot run MediaPipe (only supports 3.9-3.12). This phase establishes the correct runtime environment so all subsequent refinement work has a functioning base.
Output: Working `ml/venv/` directory, verified imports, updated PROJECT.md constraints reflecting Python 3.12 reality.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Codebase context:
@.planning/codebase/STACK.md
@.planning/codebase/CONCERNS.md

# Key source files:
@ml/requirements.txt
@ml/utils.py
@ml/test_setup.py
@ml/ws_server.py

**Constraining decisions from STATE.md:**
- Use Python 3.12 for venv (3.13 not supported by MediaPipe, 3.12 already installed via py launcher)
- MediaPipe 0.10.32 supports Python 3.9-3.12 only
- TensorFlow 2.20.0 supports Python 3.9-3.13
- OpenCV 4.13.0.92 supports Python 3.7-3.13

**Current situation:**
- System Python is 3.13 (default `py` launcher)
- Python 3.12 is installed and available via `py -3.12`
- No venv exists at `ml/venv/`
- `ml/requirements.txt` already updated for Python 3.12 compatible versions
- PROJECT.md constraints section is stale (says Python 3.9-3.11, old dep versions)
- `ml/test_setup.py` warns on Python >3.11 (should be >3.12 now)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Python 3.12 venv and install dependencies</name>
  <files>ml/venv/ (created, gitignored), ml/.gitignore</files>
  <action>
  1. Create venv using the Python 3.12 launcher:
     `py -3.12 -m venv ml/venv`

  2. Verify the venv Python version is 3.12.x:
     `ml\venv\Scripts\python.exe --version`

  3. Upgrade pip inside the venv:
     `ml\venv\Scripts\python.exe -m pip install --upgrade pip`

  4. Install all dependencies from requirements.txt:
     `ml\venv\Scripts\pip.exe install -r ml/requirements.txt`

  5. Ensure `ml/.gitignore` already contains `venv/` — if not, add it so the venv directory is not tracked by git. Do NOT add a new .gitignore at root if ml/.gitignore already handles it.

  NOTE: Use Windows backslash paths for venv activation. Do NOT attempt to use `source` (Linux/macOS syntax). Use `ml\venv\Scripts\activate` or call the python/pip executables directly.
  </action>
  <verify>
  - `ml\venv\Scripts\python.exe --version` outputs Python 3.12.x
  - `ml\venv\Scripts\pip.exe list` shows all packages from requirements.txt installed
  - `ml\venv\Scripts\python.exe -c "import cv2; import mediapipe; import tensorflow; import numpy; import fastapi; print('ALL IMPORTS OK')"` succeeds
  </verify>
  <done>Python 3.12 venv exists at ml/venv/, all 10 packages from requirements.txt installed, all critical imports succeed</done>
</task>

<task type="auto">
  <name>Task 2: Run test_setup.py to verify full environment</name>
  <files>ml/test_setup.py</files>
  <action>
  1. Run the existing environment verification script using the venv Python, from the ml/ directory:
     `cd ml && ..\ml\venv\Scripts\python.exe test_setup.py`
     (test_setup.py uses `from utils import ...` so cwd must be ml/)

  2. The script checks:
     - All library imports (cv2, mediapipe, numpy, tensorflow, sklearn, fastapi)
     - Webcam access
     - MediaPipe Holistic detection on a live frame
     - utils.py contract (imports, extract_keypoints shape == (1662,))

  3. If any check fails, diagnose and fix before proceeding. Likely failures:
     - Import error: missing package → re-run pip install
     - Webcam unavailable: ensure no other app is using it
     - MediaPipe detection error: version mismatch → verify mediapipe version

  4. Before running, fix the Python version warning in test_setup.py:
     - Line 172-175: Change `if minor > 11:` to `if minor > 12:` and update the message to say "MediaPipe requires 3.9-3.12" (since 3.12 is now supported with mediapipe 0.10.32).

  NOTE: The webcam check requires a physical webcam. If running in a headless environment, the webcam check will fail — this is expected and not a blocker for dependency verification. The critical checks are imports and utils contract.
  </action>
  <verify>
  - test_setup.py outputs "ALL CHECKS PASSED" (or all checks except webcam pass if no camera available)
  - Import checks all show [PASS]
  - Utils contract check shows [PASS] for shape (1662,)
  </verify>
  <done>test_setup.py runs successfully with venv Python, all import checks pass, utils contract verified, Python version warning updated to reflect 3.12 support</done>
</task>

<task type="auto">
  <name>Task 3: Update PROJECT.md constraints to reflect Python 3.12 reality</name>
  <files>.planning/PROJECT.md</files>
  <action>
  Update the Constraints section in PROJECT.md to match the actual current state:

  1. Change Python constraint from "3.9, 3.10, or 3.11 only — MediaPipe has no wheels for 3.12+ on Windows" to "3.12 — MediaPipe 0.10.32 supports 3.9-3.12, system Python 3.13 not compatible"

  2. Update the Dependencies line from the old pinned versions:
     `numpy 1.24.3, opencv-python 4.9.0.80, mediapipe 0.10.14, tensorflow 2.15.0`
     to the current versions:
     `numpy 2.4.2, opencv-python 4.13.0.92, mediapipe 0.10.32, tensorflow 2.20.0, fastapi 0.128.6 (see ml/requirements.txt for full list)`

  3. Add a note about the venv:
     "Runtime: Python 3.12 venv at ml/venv/ (created via `py -3.12 -m venv ml/venv`)"

  Do NOT change any other sections of PROJECT.md. Only update the Constraints section.
  </action>
  <verify>
  - PROJECT.md Constraints section references Python 3.12 (not 3.9-3.11)
  - Dependency versions match ml/requirements.txt
  - Venv location documented
  </verify>
  <done>PROJECT.md Constraints section accurately reflects Python 3.12, current dependency versions, and venv location</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `ml\venv\Scripts\python.exe --version` returns Python 3.12.x
- [ ] `ml\venv\Scripts\python.exe -c "import mediapipe; print(mediapipe.__version__)"` returns 0.10.32
- [ ] `ml\venv\Scripts\python.exe -c "import tensorflow; print(tensorflow.__version__)"` returns 2.20.0
- [ ] test_setup.py import checks all PASS
- [ ] PROJECT.md constraints match actual environment
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- Python 3.12 venv created and functional at ml/venv/
- All 10 packages from requirements.txt installed and importable
- test_setup.py passes with venv Python
- PROJECT.md constraints updated to reflect reality
- No import errors when running pipeline scripts with venv Python
</success_criteria>

<output>
After completion, create `.planning/phases/11-dependency-resolution/11-01-SUMMARY.md`
</output>
